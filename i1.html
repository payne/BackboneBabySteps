<html>
    
<head>i1</head>
<body>
    <h1><a href=https://derickbailey.com/2015/08/07/making-workflow-explicit-in-javascript/>DerickBaily.com's Making Workflow Explicit</a></h1>
    <script type="text/template" id="emplFormTemplate">
       <form>
       Name: <input type="text" id="name"/>
       <br/>
       Email: <input type="text" id="email"/>
       <br/>
       <button class="next" id="next">Next</button>
    </script>
    
		<script src="node_modules/jquery/dist/jquery.js"></script>
		<script src="node_modules/underscore/underscore.js"></script>
		<script src="node_modules/backbone/backbone.js"></script>
		
    
    <script>
        var EmployeeDetailForm = Backbone.View.extend({
            tagName: "div",
            events: {
                "click .next": "nextClicked"
            },
            initialize: function(resolve) {
                this.resolve=resolve;
                console.log("initizlize, set this.resolve="+resolve);
  							console.log(resolve);
            },
            nextClicked: function(e) {
                e.preventDefault();
                var data = { 
                    name: this.$("#name").val(),
                    email: this.$("#email").val()
                };
								console.log('nextClicked() data='+JSON.stringify(data));
                var employee = new Employee(data);
                console.log('nextClicked() employee='+JSON.stringify(employee.toJSON()));
								console.log(this.resolve);
							  this.resolve(employee,"next");
            },
          template: _.template($("#emplFormTemplate").html()),
          model: Employee,
          render: function() {
              $(this.el).html(this.template());
              return this;
          }  
        });
        
        var SelectManagerForm=Backbone.View.extend({
          events: {
              "click .save": "saveClicked"
          },

          saveClicked: function(e){
             e.preventDefault();
          
             var managerId = this.$(".manager").val();
             this.model.set({managerId: managerId});
   
             this.model.save();
             // do something to close the wizard and move on  
          },
          render: function() {
              
          }  
        });
        
        var Employee = Backbone.Model.extend({});

        var orgChart = {
            addNewEmployee: function() {
							  let problem = () => { console.log("PROBLEM!!!"); }
                let nextStep = (employee, buttonName) => {
                   console.log("then: employee.save()");
                   //console.log('nextClicked() employee='+JSON.stringify(employee.toJSON()));
                   //var managerSelector = this.selectManager(employee);
                   //managerSelector.on("save",function(employee) {
                     // employee.save(); 
                };
                var employeeDetail = this.getEmployeeDetail(nextStep, problem);
							  employeeDetail.then((e, bn) => {
									console.log('bn='+bn);
									console.log(e);
									console.log(JSON.stringify(e.toJSON));
								});
            },
            
            getEmployeeDetail: function(resolve,reject) {
                  var form = new EmployeeDetailForm(resolve); 
                  form.render();
                  $("#wizard").html(form.el);
               return new Promise(resolve,reject);
            },
            
            selectManager: function(employee) {
                var form = new SelectManagerForm({model: employee});
                form.render();
                $("#wizard").html(form.el);
                return form;
            }
            
        };
        

    $(document).ready(function() { 
        
        orgChart.addNewEmployee(); 
        
        
    });
    </script>
    
    
    <h1>Wizard below </h1>
    <div id="wizard"></div>
</body>
</html>

	
